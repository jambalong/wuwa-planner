<%# locals: (step:, plan_type:, subjects:, subject: nil, errors: nil) %>

<div class="p-8 flex flex-col h-[550px]" data-controller="search-filter">
  <header class="mb-6">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-black text-ctp-text tracking-tight">Select
        <%= plan_type %></h2>
    </div>

    <%# Search Bar Interface %>
    <div class="relative mt-4">
      <div
        class="
          absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none
        "
      >
        <svg
          class="h-4 w-4 text-ctp-surface2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="3"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>
      <input
        type="text"
        data-search-filter-target="input"
        data-action="input->search-filter#filter"
        placeholder="Search by name..."
        class="
          w-full pl-10 pr-4 py-2 bg-ctp-mantle border-2 border-ctp-surface2 rounded-xl
          text-sm text-ctp-text placeholder-ctp-surface2 focus:border-ctp-mauve
          focus:ring-0 focus:outline-0 transition-colors
        "
      >
    </div>
  </header>

  <%# Scrollable List Area %>
  <div
    class="
      grow overflow-y-auto rounded-xl shadow-inner bg-ctp-base custom-scrollbar
    "
  >
    <% subjects.each do |subject_record| %>
      <div
        data-search-filter-target="subject"
        data-search-name="<%= subject_record.name %>"
      >
        <%= link_to new_plan_path(plan_type: plan_type, subject_id: subject_record.id, step: 3), 
            data: { turbo_frame: "modal" }, 
            class: "flex items-center justify-between p-2 bg-ctp-base hover:bg-ctp-surface0 transition-all group" do %>

          <div class="flex items-center gap-4">
            <div
              class="
                w-10 h-10 rounded-xl bg-ctp-text flex items-center justify-center text-xl
                group-hover:shadow-sm transition-all
              "
            >
              <%= plan_type == "Resonator" ? "ðŸ‘¤" : "âš”ï¸" %>
            </div>
            <span class="font-bold <%= subject_record.rarity == 5 ? 'star-5' : 'star-4' %>">
              <%= subject_record.name %>
            </span>
          </div>

          <div
            class="
              text-gray-300 group-hover:text-ctp-mauve transition-transform
              group-hover:translate-x-1
            "
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <footer
    class="
      mt-6 pt-4 border-t border-ctp-surface0 flex items-center justify-between
    "
  >
    <%= link_to new_plan_path(step: 1), 
        data: { turbo_frame: "modal" },
        class: "text-xs font-bold text-ctp-subtext0 hover:text-ctp-mauve flex items-center gap-1 transition-colors" do %>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-3 w-3"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="3"
          d="M15 19l-7-7 7-7"
        />
      </svg>
      Back
    <% end %>

    <span
      class="
        text-[10px] text-ctp-subtext0 font-medium uppercase tracking-widest
      "
    >Scroll for more</span>
  </footer>
</div>
